# 边界线移动时的碰撞问题

![极点对](./碰撞.bmp)
## 位置转移

|    移动方向  | -> |  对角点 |   对角点位置  |           W-H         |
:-------------:|:--:|:------:|:------------:|:----------------------:
|右下(RD++)    | -> |  左上   |上(-) / 下(+)  |(R-L)={-W} / (D-U)={-H}|
|左上(LU--)    | -> |  右下   |上(+) / 下(-)  |(U-D)={+H} / (L-R)={+W}|
|左下(LD-+)    | -> |  右上   |上(+) / 下(-)  |(L-R)={+W} / (D-U)={-H}|
|右上(RU+-)    | -> |  左下   |上(-) / 下(+)  |(U-D)={+H} / (R-L)={-W}|


## 对角点位置的计算

 几个已知条件：
  1. 移动的向量坐标where(x,y)
  1. 各个框子的Up Down Left Right坐标

 几个说明：
  1. 被移动框子为Move，可能碰撞的框子为Curr
  1. 由移动方向可以知道对角点，如上表，不妨设起点为O(Ox,Oy),终点为E(Ex，Ey),
      很明显有O+where=E，即Ox+x=Ex,Oy+y=Ey
  1. 可能碰撞的框子的对角点坐标C(Cx,Cy)
  1. 以O点为坐标原点，则其他点的坐标经变换为O(0,0),E(x,y),C(Cx-Ox,Cy-Oy)
  1. 则向量OE(x,y) OC(Cx-Ox,Cy-Oy)

 定义及计算：(详见上图)
  1. 对角点位置：如果C点在向量的OE的上方为负(-);在下方或向量上为正(+)
  1. 计算方法：
      OC * OE = (Cx-Ox,Cy-Oy) * (x,y) = (Cx-Ox)*y -(Cy-Oy)*x
      - OC * OE >  则C在向量的上方(逆时针)
      - OC * OE <= 则C在向量的下方或向量上，为了考虑和计算方便(顺时针)

## 总结

  由上表及图可以知道，只要计算出移动的距离，其中最小值即是最先碰撞的最大移动的向量的
真正的终点，由于对于所有点移动的方向是一样的，故将其投影在纵(横)轴方向得到H(W)，
此处不妨投影在纵轴，即只比较H。

## 注意

 1. 关于移动最小距离，不只是H最小的，要检测此时是否相交
 1. 所谓的移动的目的是为了修正移动向量where的值，不改变其方向
 1. 对于碰撞后的处理，暂时设置为与被碰撞的框子之间的重合或相隔一定距离(或许未来会提供弹性变形或反弹的仿真效果)
    提供了一个间隔参数来设置确定，默认为0

